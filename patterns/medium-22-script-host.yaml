name: medium-22-script-host
severity: medium
description: >
  Detects Windows Script Host executing scripts from temp locations. Legacy script execution abused in attacks.

pattern: |
  (?i)(wscript|cscript).*([Tt]emp|AppData|Users.{0,2}Public|ProgramData|/tmp).*\.(vbs|js|wsf|vbe|jse)

malicious:
  - "wscript C:\\Windows\\Temp\\malicious.vbs"
  - "cscript C:\\Temp\\backdoor.js"
  - "wscript.exe C:\\Users\\victim\\AppData\\Local\\Temp\\dropper.vbs"
  - "cscript.exe C:\\Users\\Public\\evil.js"
  - "wscript //B C:\\Temp\\hidden.vbs"
  - "cscript //nologo C:\\Windows\\Temp\\payload.js"
  - "wscript.exe C:\\ProgramData\\trojan.vbs"
  - "cscript C:\\Users\\user\\AppData\\Roaming\\malware.js"
  - "wscript //E:vbscript C:\\Temp\\clickfix.vbs"
  - "cscript.exe C:\\Users\\Public\\Downloads\\backdoor.wsf"
  - "wscript C:\\Windows\\Temp\\obfuscated.vbe"
  - "cscript //T:30 C:\\Temp\\implant.js"
  - "wscript.exe C:\\Users\\victim\\AppData\\Local\\Temp\\ransomware.jse"
  - "cscript C:\\ProgramData\\loader.vbs"
  - "wscript //B //nologo C:\\Temp\\stealth.js"
  - "cscript.exe C:\\Windows\\Temp\\dropper.wsf"
  - "wscript C:\\Users\\Public\\persistence.vbs"
  - "cscript //E:jscript C:\\Temp\\encoded.jse"
  - "wscript.exe /tmp/malware.vbs"
  - "cscript /var/tmp/evil.js"

benign:
  - "wscript C:\\Scripts\\automation.vbs"
  - "cscript C:\\Admin\\maintenance.js"
  - "wscript.exe C:\\Program Files\\App\\setup.vbs"
  - "cscript D:\\Projects\\build.js"
  - "wscript C:\\IT\\Scripts\\backup.vbs"
  - "cscript.exe C:\\Users\\admin\\Documents\\report.js"
  - "wscript C:\\Work\\automation.wsf"
  - "cscript //nologo C:\\Scripts\\monitor.vbs"
  - "wscript.exe C:\\Source\\deploy.js"
  - "cscript C:\\Development\\test.vbs"
  - "wscript C:\\Tools\\utility.js"
  - "cscript.exe C:\\Admin\\Scripts\\status.vbs"
  - "wscript //B C:\\Scheduled\\task.vbs"
  - "cscript C:\\Windows\\System32\\slmgr.vbs"
  - "wscript.exe C:\\Program Files (x86)\\Company\\script.vbs"
  - "cscript C:\\IT\\monitoring.js"
  - "wscript C:\\Users\\administrator\\Scripts\\cleanup.vbs"
  - "cscript.exe E:\\Backup\\archive.js"
  - "wscript C:\\Apps\\Local\\helper.vbs"
  - "cscript C:\\Shared\\Scripts\\update.js"
